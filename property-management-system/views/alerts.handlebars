<!-- Alerts Header -->
<div class="flex items-center justify-between mb-8">
    <div>
        <h2 class="text-2xl font-bold text-gray-800">Alerts & Notifications</h2>
        <p class="text-gray-600">Stay on top of important property management tasks</p>
    </div>
    <div class="flex space-x-4">
        <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center">
            <i class="fas fa-plus mr-2"></i>
            Create Alert
        </button>
        <button class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg flex items-center">
            <i class="fas fa-check-double mr-2"></i>
            Mark All Read
        </button>
    </div>
</div>

<!-- Alert Summary Cards -->
<div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
    <div class="bg-white rounded-lg shadow-sm p-6 border-l-4 border-red-500">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-gray-600 text-sm">High Priority</p>
                <p class="text-2xl font-bold text-red-600" id="high-priority-count">
                    {{#each alerts}}{{#if (eq priority 'High')}}1{{else}}0{{/if}}{{/each}}
                </p>
            </div>
            <i class="fas fa-exclamation-triangle text-red-500 text-2xl"></i>
        </div>
    </div>

    <div class="bg-white rounded-lg shadow-sm p-6 border-l-4 border-yellow-500">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-gray-600 text-sm">Medium Priority</p>
                <p class="text-2xl font-bold text-yellow-600" id="medium-priority-count">
                    {{#each alerts}}{{#if (eq priority 'Medium')}}1{{else}}0{{/if}}{{/each}}
                </p>
            </div>
            <i class="fas fa-exclamation-circle text-yellow-500 text-2xl"></i>
        </div>
    </div>

    <div class="bg-white rounded-lg shadow-sm p-6 border-l-4 border-green-500">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-gray-600 text-sm">Low Priority</p>
                <p class="text-2xl font-bold text-green-600" id="low-priority-count">
                    {{#each alerts}}{{#if (eq priority 'Low')}}1{{else}}0{{/if}}{{/each}}
                </p>
            </div>
            <i class="fas fa-info-circle text-green-500 text-2xl"></i>
        </div>
    </div>

    <div class="bg-white rounded-lg shadow-sm p-6 border-l-4 border-blue-500">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-gray-600 text-sm">Total Active</p>
                <p class="text-2xl font-bold text-blue-600">{{alerts.length}}</p>
            </div>
            <i class="fas fa-bell text-blue-500 text-2xl"></i>
        </div>
    </div>
</div>

<!-- Filters -->
<div class="bg-white rounded-lg shadow-sm p-6 mb-8">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Search Alerts</label>
            <input type="text" id="alert-search" placeholder="Search alerts..."
                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Priority</label>
            <select id="priority-filter" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="">All Priorities</option>
                <option value="High">High</option>
                <option value="Medium">Medium</option>
                <option value="Low">Low</option>
            </select>
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Alert Type</label>
            <select id="type-filter" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="">All Types</option>
                <option value="lease_renewal">Lease Renewal</option>
                <option value="maintenance_due">Maintenance</option>
                <option value="payment_overdue">Payment Overdue</option>
                <option value="inspection_due">Inspection</option>
                <option value="tax_assessment">Tax Assessment</option>
            </select>
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Due Date</label>
            <select id="date-filter" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="">All Dates</option>
                <option value="overdue">Overdue</option>
                <option value="today">Due Today</option>
                <option value="week">Next 7 Days</option>
                <option value="month">Next 30 Days</option>
            </select>
        </div>
    </div>
</div>

<!-- Alerts List -->
<div class="space-y-4" id="alerts-list">
    {{#each alerts}}
    <div class="alert-item bg-white rounded-lg shadow-sm border-l-4 {{priorityClass priority}} p-6 hover:shadow-md transition-shadow"
         data-priority="{{priority}}" data-type="{{alert_type}}" data-due="{{due_date}}">

        <div class="flex items-start justify-between">
            <!-- Alert Content -->
            <div class="flex-1">
                <div class="flex items-center mb-2">
                    <!-- Alert Type Icon -->
                    <div class="mr-3">
                        {{#if (eq alert_type 'lease_renewal')}}
                            <i class="fas fa-file-contract text-blue-500 text-lg"></i>
                        {{else if (eq alert_type 'maintenance_due')}}
                            <i class="fas fa-tools text-orange-500 text-lg"></i>
                        {{else if (eq alert_type 'payment_overdue')}}
                            <i class="fas fa-dollar-sign text-red-500 text-lg"></i>
                        {{else if (eq alert_type 'inspection_due')}}
                            <i class="fas fa-search text-purple-500 text-lg"></i>
                        {{else if (eq alert_type 'tax_assessment')}}
                            <i class="fas fa-receipt text-green-500 text-lg"></i>
                        {{else}}
                            <i class="fas fa-bell text-gray-500 text-lg"></i>
                        {{/if}}
                    </div>

                    <!-- Title and Priority -->
                    <div class="flex-1">
                        <h3 class="font-semibold text-gray-800 text-lg">{{title}}</h3>
                        <span class="inline-block px-2 py-1 text-xs rounded-full {{priorityClass priority}} mt-1">
                            {{priority}} Priority
                        </span>
                    </div>
                </div>

                <!-- Alert Message -->
                <p class="text-gray-600 mb-3 ml-8">{{message}}</p>

                <!-- Property and Manager Info -->
                <div class="flex items-center text-sm text-gray-500 ml-8 space-x-4">
                    {{#if address}}
                    <div class="flex items-center">
                        <i class="fas fa-map-marker-alt mr-1"></i>
                        <span>{{address}}</span>
                    </div>
                    {{/if}}
                    {{#if manager_name}}
                    <div class="flex items-center">
                        <i class="fas fa-user mr-1"></i>
                        <span>{{manager_name}}</span>
                    </div>
                    {{/if}}
                    <div class="flex items-center">
                        <i class="fas fa-calendar mr-1"></i>
                        <span>Due: {{formatDate due_date}}</span>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex space-x-2 ml-4">
                <button class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm transition">
                    <i class="fas fa-eye mr-1"></i>
                    View
                </button>
                <button class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm transition"
                        onclick="resolveAlert({{id}})">
                    <i class="fas fa-check mr-1"></i>
                    Resolve
                </button>
                <button class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded text-sm transition">
                    <i class="fas fa-edit mr-1"></i>
                    Edit
                </button>
            </div>
        </div>

        <!-- Due Date Indicator -->
        <div class="mt-4 ml-8">
            {{#if (isOverdue due_date)}}
                <div class="flex items-center text-red-600 text-sm font-medium">
                    <i class="fas fa-exclamation-triangle mr-1"></i>
                    <span class="bg-red-100 px-2 py-1 rounded">OVERDUE</span>
                </div>
            {{else if (isDueToday due_date)}}
                <div class="flex items-center text-orange-600 text-sm font-medium">
                    <i class="fas fa-clock mr-1"></i>
                    <span class="bg-orange-100 px-2 py-1 rounded">DUE TODAY</span>
                </div>
            {{else if (isDueSoon due_date)}}
                <div class="flex items-center text-yellow-600 text-sm font-medium">
                    <i class="fas fa-calendar-alt mr-1"></i>
                    <span class="bg-yellow-100 px-2 py-1 rounded">DUE SOON</span>
                </div>
            {{/if}}
        </div>
    </div>
    {{/each}}
</div>

<!-- Empty State -->
<div id="no-alerts" class="{{#if alerts}}hidden{{/if}} text-center py-12">
    <i class="fas fa-check-circle text-4xl text-green-400 mb-4"></i>
    <h3 class="text-lg font-medium text-gray-600 mb-2">No alerts found</h3>
    <p class="text-gray-500">All caught up! No urgent tasks at the moment.</p>
</div>

<!-- Alert Statistics -->
<div class="mt-12 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg p-8 text-white">
    <h3 class="text-2xl font-bold mb-6">Alert Analytics</h3>
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
        <div class="text-center">
            <p class="text-3xl font-bold">{{alerts.length}}</p>
            <p class="text-blue-100">Active Alerts</p>
        </div>
        <div class="text-center">
            <p class="text-3xl font-bold" id="overdue-count">0</p>
            <p class="text-blue-100">Overdue</p>
        </div>
        <div class="text-center">
            <p class="text-3xl font-bold" id="due-today-count">0</p>
            <p class="text-blue-100">Due Today</p>
        </div>
        <div class="text-center">
            <p class="text-3xl font-bold" id="resolved-today-count">0</p>
            <p class="text-blue-100">Resolved Today</p>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('alert-search');
    const priorityFilter = document.getElementById('priority-filter');
    const typeFilter = document.getElementById('type-filter');
    const dateFilter = document.getElementById('date-filter');
    const alertsList = document.getElementById('alerts-list');
    const noAlerts = document.getElementById('no-alerts');

    function filterAlerts() {
        const searchTerm = searchInput.value.toLowerCase();
        const selectedPriority = priorityFilter.value;
        const selectedType = typeFilter.value;
        const selectedDate = dateFilter.value;

        const alertItems = alertsList.querySelectorAll('.alert-item');
        let visibleCount = 0;

        alertItems.forEach(item => {
            const title = item.querySelector('h3').textContent.toLowerCase();
            const message = item.querySelector('p').textContent.toLowerCase();
            const priority = item.dataset.priority;
            const type = item.dataset.type;
            const dueDate = new Date(item.dataset.due);
            const today = new Date();
            const daysDiff = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));

            const matchesSearch = title.includes(searchTerm) || message.includes(searchTerm);
            const matchesPriority = !selectedPriority || priority === selectedPriority;
            const matchesType = !selectedType || type === selectedType;

            let matchesDate = true;
            if (selectedDate) {
                switch (selectedDate) {
                    case 'overdue':
                        matchesDate = daysDiff < 0;
                        break;
                    case 'today':
                        matchesDate = daysDiff === 0;
                        break;
                    case 'week':
                        matchesDate = daysDiff <= 7 && daysDiff >= 0;
                        break;
                    case 'month':
                        matchesDate = daysDiff <= 30 && daysDiff >= 0;
                        break;
                }
            }

            if (matchesSearch && matchesPriority && matchesType && matchesDate) {
                item.style.display = 'block';
                visibleCount++;
            } else {
                item.style.display = 'none';
            }
        });

        // Toggle no results message
        if (visibleCount === 0) {
            alertsList.style.display = 'none';
            noAlerts.style.display = 'block';
        } else {
            alertsList.style.display = 'block';
            noAlerts.style.display = 'none';
        }
    }

    // Add event listeners
    searchInput.addEventListener('input', filterAlerts);
    priorityFilter.addEventListener('change', filterAlerts);
    typeFilter.addEventListener('change', filterAlerts);
    dateFilter.addEventListener('change', filterAlerts);

    // Calculate statistics
    updateStatistics();
});

function updateStatistics() {
    const alerts = document.querySelectorAll('.alert-item');
    const today = new Date();
    let overdueCount = 0;
    let dueTodayCount = 0;

    alerts.forEach(alert => {
        const dueDate = new Date(alert.dataset.due);
        const daysDiff = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));

        if (daysDiff < 0) overdueCount++;
        if (daysDiff === 0) dueTodayCount++;
    });

    document.getElementById('overdue-count').textContent = overdueCount;
    document.getElementById('due-today-count').textContent = dueTodayCount;
}

function resolveAlert(alertId) {
    if (confirm('Are you sure you want to resolve this alert?')) {
        // In a real application, this would make an API call
        // For now, we'll just hide the alert
        const alertElement = document.querySelector(`[data-alert-id="${alertId}"]`);
        if (alertElement) {
            alertElement.style.animation = 'fadeOut 0.3s ease-out';
            setTimeout(() => {
                alertElement.remove();
                updateStatistics();
            }, 300);
        }
    }
}
</script>

<style>
@keyframes fadeOut {
    from { opacity: 1; transform: translateX(0); }
    to { opacity: 0; transform: translateX(100%); }
}

.alert-item {
    transition: all 0.2s ease;
}

.alert-item:hover {
    transform: translateY(-1px);
}
</style>