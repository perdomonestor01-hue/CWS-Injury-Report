{
  "meta": {
    "instanceId": "jufipai-enterprise-safety-system"
  },
  "nodes": [
    {
      "parameters": {
        "intervalSize": 15,
        "intervalUnit": "minutes"
      },
      "id": "safety-monitor-trigger",
      "name": "Safety Data Monitor",
      "type": "n8n-nodes-base.interval",
      "typeVersion": 1,
      "position": [100, 200]
    },
    {
      "parameters": {
        "requestMethod": "GET",
        "url": "={{ $env.SAFETY_API_ENDPOINT }}/injuries/recent"
      },
      "id": "fetch-injury-data",
      "name": "Fetch Recent Injury Data",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [300, 200]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "critical-injury-check",
              "leftValue": "={{ $json.severity }}",
              "rightValue": "Major",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "or"
        }
      },
      "id": "critical-injury-filter",
      "name": "Critical Injury Detection",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [500, 200]
    },
    {
      "parameters": {
        "operation": "create",
        "parent": {
          "page_id": "{{ $env.NOTION_SAFETY_DATABASE_ID }}"
        },
        "properties": {
          "title": [
            {
              "text": {
                "content": "üö® CRITICAL SAFETY ALERT: {{ $json.injury_type }} - {{ $json.employee_id }}"
              }
            }
          ]
        }
      },
      "id": "create-notion-alert",
      "name": "Log Critical Alert to Notion",
      "type": "mcp__MCP_DOCKER__API-post-page",
      "typeVersion": 1,
      "position": [700, 100]
    },
    {
      "parameters": {
        "to": "{{ $env.CEO_EMAIL }}",
        "subject": "üö® URGENT: Critical Workplace Injury Alert",
        "message": "IMMEDIATE ATTENTION REQUIRED\n\nA critical workplace injury has been reported:\n\nüìç Location: {{ $json.location }}\nüë§ Employee: {{ $json.employee_id }}\nü©π Injury Type: {{ $json.injury_type }}\nüìÖ Date: {{ $json.date }}\nüí∞ Estimated Cost: ${{ $json.cost }}\n‚ö†Ô∏è Severity: {{ $json.severity }}\n\nAction Items:\n1. Ensure employee receives immediate medical attention\n2. Secure the incident area\n3. Begin safety investigation\n4. Contact workers' compensation provider\n\nView Full Dashboard: {{ $env.DASHBOARD_URL }}\n\n---\nPowered by Jufipai.com Enterprise Safety Analytics\nFabien Perdomo ¬© All Rights Reserved"
      },
      "id": "ceo-alert-email",
      "name": "CEO Critical Alert Email",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2,
      "position": [700, 200]
    },
    {
      "parameters": {
        "operation": "send",
        "chatId": "{{ $env.SLACK_SAFETY_CHANNEL }}",
        "text": "üö® **CRITICAL SAFETY ALERT** üö®\n\n**{{ $json.injury_type }}** reported at **{{ $json.location }}**\n\n**Details:**\n‚Ä¢ Employee: {{ $json.employee_id }}\n‚Ä¢ Date: {{ $json.date }}\n‚Ä¢ Body Part: {{ $json.body_part }}\n‚Ä¢ Cause: {{ $json.cause }}\n‚Ä¢ Cost: ${{ $json.cost }}\n‚Ä¢ Days Lost: {{ $json.days_lost }}\n\n**IMMEDIATE ACTION REQUIRED**\n@safety-team @management\n\nView Dashboard: {{ $env.DASHBOARD_URL }}"
      },
      "id": "slack-alert",
      "name": "Slack Safety Team Alert",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 1,
      "position": [700, 300]
    },
    {
      "parameters": {
        "operation": "aggregate",
        "aggregate": {
          "aggregations": [
            {
              "column": "cost",
              "operation": "sum"
            },
            {
              "column": "days_lost",
              "operation": "sum"
            },
            {
              "column": "severity",
              "operation": "count"
            }
          ]
        }
      },
      "id": "calculate-weekly-metrics",
      "name": "Weekly Safety Metrics",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [300, 400]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "threshold-check",
              "leftValue": "={{ $json.cost_sum }}",
              "rightValue": 50000,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "or"
        }
      },
      "id": "threshold-monitor",
      "name": "Cost Threshold Monitor",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [500, 400]
    },
    {
      "parameters": {
        "to": "{{ $env.CFO_EMAIL }},{{ $env.CEO_EMAIL }}",
        "subject": "üìä Weekly Safety Cost Alert - Threshold Exceeded",
        "message": "Weekly Safety Cost Report - ATTENTION REQUIRED\n\nüìà **COST THRESHOLD EXCEEDED**\n\nWeekly Totals:\nüí∞ Total Cost: ${{ $json.cost_sum }}\nüìä Total Incidents: {{ $json.severity_count }}\n‚è∞ Total Days Lost: {{ $json.days_lost_sum }}\nüìÖ Week Ending: {{ $now.format('YYYY-MM-DD') }}\n\nüéØ **Performance vs Targets:**\n‚Ä¢ Weekly Budget: $50,000\n‚Ä¢ Current: ${{ $json.cost_sum }}\n‚Ä¢ Variance: ${{ $json.cost_sum - 50000 }}\n\nüìã **Recommended Actions:**\n1. Review high-cost incidents\n2. Implement additional safety measures\n3. Schedule emergency safety meeting\n4. Assess training needs\n\nüîó **Quick Links:**\n‚Ä¢ Executive Dashboard: {{ $env.DASHBOARD_URL }}\n‚Ä¢ Detailed Reports: {{ $env.DASHBOARD_URL }}/reports\n‚Ä¢ Safety Analytics: {{ $env.DASHBOARD_URL }}/analytics\n\n---\nüíº Jufipai.com Enterprise Safety Analytics\nüë®‚Äçüíº Fabien Perdomo ¬© All Rights Reserved\nüè¢ Fortune 500 Safety Management Solutions"
      },
      "id": "executive-cost-alert",
      "name": "Executive Cost Alert",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2,
      "position": [700, 400]
    },
    {
      "parameters": {
        "operation": "search",
        "query": "safety training workplace injury prevention",
        "maxResults": 3
      },
      "id": "youtube-training-search",
      "name": "Find Safety Training Videos",
      "type": "mcp__MCP_DOCKER__get_video_info",
      "typeVersion": 1,
      "position": [300, 600]
    },
    {
      "parameters": {
        "operation": "create",
        "parent": {
          "page_id": "{{ $env.NOTION_TRAINING_DATABASE_ID }}"
        },
        "properties": {
          "title": [
            {
              "text": {
                "content": "üì∫ Weekly Safety Training Resources - {{ $now.format('YYYY-MM-DD') }}"
              }
            }
          ]
        },
        "children": [
          {
            "type": "paragraph",
            "paragraph": {
              "rich_text": [
                {
                  "type": "text",
                  "text": {
                    "content": "üéØ **Recommended Training Based on Recent Incidents:**\n\n"
                  }
                }
              ]
            }
          }
        ]
      },
      "id": "create-training-page",
      "name": "Create Training Resource Page",
      "type": "mcp__MCP_DOCKER__API-post-page",
      "typeVersion": 1,
      "position": [500, 600]
    },
    {
      "parameters": {
        "intervalSize": 1,
        "intervalUnit": "hours"
      },
      "id": "ai-analysis-trigger",
      "name": "AI Analytics Trigger",
      "type": "n8n-nodes-base.interval",
      "typeVersion": 1,
      "position": [100, 800]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "Analyze the following workplace injury data and provide insights:\n\n{{ $json }}\n\nProvide:\n1. Risk pattern analysis\n2. Preventive recommendations\n3. Cost optimization strategies\n4. Department-specific action items\n\nFormat as executive summary for C-level stakeholders.",
        "options": {}
      },
      "id": "ai-safety-analysis",
      "name": "AI Safety Analytics",
      "type": "n8n-nodes-base.openAi",
      "typeVersion": 1,
      "position": [300, 800]
    },
    {
      "parameters": {
        "operation": "create",
        "parent": {
          "page_id": "{{ $env.NOTION_ANALYTICS_DATABASE_ID }}"
        },
        "properties": {
          "title": [
            {
              "text": {
                "content": "ü§ñ AI Safety Analytics Report - {{ $now.format('YYYY-MM-DD HH:mm') }}"
              }
            }
          ]
        },
        "children": [
          {
            "type": "paragraph",
            "paragraph": {
              "rich_text": [
                {
                  "type": "text",
                  "text": {
                    "content": "{{ $json.choices[0].message.content }}"
                  }
                }
              ]
            }
          }
        ]
      },
      "id": "log-ai-insights",
      "name": "Log AI Insights to Notion",
      "type": "mcp__MCP_DOCKER__API-post-page",
      "typeVersion": 1,
      "position": [500, 800]
    },
    {
      "parameters": {
        "intervalSize": 6,
        "intervalUnit": "hours"
      },
      "id": "dashboard-health-check",
      "name": "Dashboard Health Monitor",
      "type": "n8n-nodes-base.interval",
      "typeVersion": 1,
      "position": [100, 1000]
    },
    {
      "parameters": {
        "requestMethod": "GET",
        "url": "{{ $env.DASHBOARD_URL }}/health"
      },
      "id": "check-dashboard-status",
      "name": "Check Dashboard Status",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [300, 1000]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "status-check",
              "leftValue": "={{ $json.status }}",
              "rightValue": "healthy",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "or"
        }
      },
      "id": "dashboard-health-filter",
      "name": "Dashboard Health Check",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [500, 1000]
    },
    {
      "parameters": {
        "to": "{{ $env.IT_TEAM_EMAIL }}",
        "subject": "üö® URGENT: Safety Dashboard System Alert",
        "message": "SYSTEM ALERT - IMMEDIATE ATTENTION REQUIRED\n\nüî¥ **Dashboard Status: {{ $json.status }}**\n\nThe Executive Safety Dashboard is experiencing issues:\n\n‚ö†Ô∏è **Issue Details:**\n‚Ä¢ Status: {{ $json.status }}\n‚Ä¢ Response Time: {{ $json.response_time }}ms\n‚Ä¢ Last Check: {{ $now.format('YYYY-MM-DD HH:mm:ss') }}\n‚Ä¢ Error: {{ $json.error || 'Unknown' }}\n\nüéØ **Impact:**\n‚Ä¢ Real-time safety monitoring compromised\n‚Ä¢ Executive reporting affected\n‚Ä¢ Critical alerts may be delayed\n\nüîß **Action Required:**\n1. Investigate dashboard infrastructure\n2. Check API endpoints\n3. Verify database connections\n4. Restore service ASAP\n5. Report status to safety team\n\nüìä Dashboard URL: {{ $env.DASHBOARD_URL }}\n\n---\n‚ö° Jufipai.com Enterprise Infrastructure\nFabien Perdomo ¬© All Rights Reserved"
      },
      "id": "dashboard-alert-email",
      "name": "IT Dashboard Alert",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2,
      "position": [700, 1000]
    }
  ],
  "connections": {
    "Safety Data Monitor": {
      "main": [
        [
          {
            "node": "Fetch Recent Injury Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Recent Injury Data": {
      "main": [
        [
          {
            "node": "Critical Injury Detection",
            "type": "main",
            "index": 0
          },
          {
            "node": "Weekly Safety Metrics",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Critical Injury Detection": {
      "main": [
        [
          {
            "node": "Log Critical Alert to Notion",
            "type": "main",
            "index": 0
          },
          {
            "node": "CEO Critical Alert Email",
            "type": "main",
            "index": 0
          },
          {
            "node": "Slack Safety Team Alert",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Weekly Safety Metrics": {
      "main": [
        [
          {
            "node": "Cost Threshold Monitor",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cost Threshold Monitor": {
      "main": [
        [
          {
            "node": "Executive Cost Alert",
            "type": "main",
            "index": 0
          },
          {
            "node": "Find Safety Training Videos",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Find Safety Training Videos": {
      "main": [
        [
          {
            "node": "Create Training Resource Page",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Analytics Trigger": {
      "main": [
        [
          {
            "node": "AI Safety Analytics",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Safety Analytics": {
      "main": [
        [
          {
            "node": "Log AI Insights to Notion",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Dashboard Health Monitor": {
      "main": [
        [
          {
            "node": "Check Dashboard Status",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Dashboard Status": {
      "main": [
        [
          {
            "node": "Dashboard Health Check",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Dashboard Health Check": {
      "main": [
        [
          {
            "node": "IT Dashboard Alert",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "createdAt": "2024-12-15T10:00:00.000Z",
      "updatedAt": "2024-12-15T10:00:00.000Z",
      "id": "safety-enterprise",
      "name": "Enterprise Safety Monitoring"
    }
  ],
  "triggerCount": 4,
  "updatedAt": "2024-12-15T10:00:00.000Z",
  "versionId": "enterprise-safety-v1.0"
}